# SecurityDatasets GoldenSAML Microsoft365DefenderEvents.json to OSCF mapping


# endpoint: see https://schema.ocsf.io/1.1.0/objects/endpoint
device: &endpoint
    hostname: DeviceName
    uid: DeviceId


file: &file
    endpoint: *endpoint
    name: FileName


# https://schema.ocsf.io/1.1.0/objects/process
process:
    endpoint: *endpoint
    cmd_line: InitiatingProcessCommandLine
    pid: InitiatingProcessId
    uid: InitiatingProcessId
    file:
        name: InitiatingProcessFileName
        path: InitiatingProcessFolderPath
        parent_folder:
            native_field: InitiatingProcessFolderPath
            native_op: LIKE
            native_value: winpath_startswith
            ocsf_value: dirname
    user:
        name: InitiatingProcessAccountUpn
        uid: InitiatingProcessAccountSid


# src_endpoint: see https://schema.ocsf.io/1.1.0/objects/endpoint
src_endpoint: &src_ref
    ip: IPAddress
    port: Port


# dst_endpoint: see https://schema.ocsf.io/1.1.0/objects/endpoint
dst_endpoint: &dst_ref
    hostname: DestinationDevice
    ip: DestinationIPAddress
    port: DestinationPort


# https://schema.ocsf.io/1.1.0/objects/user
user: &user
    domain: AccountDomain
    name: AccountName
    uid: AccountSid


# https://schema.ocsf.io/1.1.0/classes/network_activity
# Network Activity [4001] Class
network_activity:
    src_endpoint: *src_ref
    dst_endpoint: *dst_ref


# https://schema.ocsf.io/1.1.0/classes/api_activity
# API Activity [6003]
api_activity:
    src_endpoint: *src_ref
    dst_endpoint: *dst_ref
    http_request:
        user_agent: UserAgent


# https://schema.ocsf.io/1.1.0/classes/datastore_activity
# Datastore Activity [6005]
datastore_activity:
    src_endpoint: *src_ref
    dst_endpoint: *dst_ref
    http_request:
        user_agent: UserAgent
    query_info:
        attr_list: AdditionalFields.AttributeList
        search_filter: AdditionalFields.SearchFilter


# https://schema.ocsf.io/1.1.0/classes/file_activity?extensions=win
# File System Activity [1001]
file_activity:
    device: *endpoint
    file: *file


# https://schema.ocsf.io/1.1.0/classes/entity_management
# Entity Management [3004]
entity_management:
    entity:
        data: ActivityObjects


# https://schema.ocsf.io/1.1.0/classes/base_event
# Base Event
type_uid:
    native_field: ActionType
    native_value:
        300403: # Entity Management: Update
            - "MailItemsAccessed"
        300501: # User Access Management: Assign Privileges
            - "Add delegated permission grant."
        600504: # Datastore Activity: Query
            - "LdapSearch"
        600599: # Datastore Activity: Other
            - "Directory Services replication"
status_id:
  - native_field: RawEventData.ResultStatus
    native_value:
        1: # Success
            - "Succeeded"
        2: # Failure
            - "Failed"
